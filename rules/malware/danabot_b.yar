rule win_danabot_b {

    meta:
        author          = "Johannes Bader @viql"
        date            = "2022-12-12"
        version         = "v1.0"
        description     = "detects some unpacked DanaBot samples"
        hash_md5        = "28f7d884f4f18ce6596dc3c81805e7ff"
        hash_sha1       = "e3ee8e4fe55c3faa782e100418407d60e227fe3c"
        hash_sha256     = "338bf223538fda403d18e685bbdae7d9d1d88df9ec2cdcb7dac1c52a26ae52f7"
        tlp             = "TLP:WHITE"
        malpedia_family = "win.danabot"

    strings:
        $exe_01   = "at.exe"
        $exe_02   = "pcwrun.exe"
        $exe_03   = "msfeedssync.exe"
        $exe_04   = "winrshost.exe"
        $exe_05   = "appidcertstorecheck.exe"
        $exe_06   = "wksprt.exe"
        $exe_07   = "wmpshare.exe"
        $exe_08   = "relog.exe"

        $dll_1    = "BdeHdCfgLib.dll"
        $dll_2    = "EhStorShell.dll"
        $dll_3    = "MpClient.dll"
        $dll_4    = "VGX.dll"
        $dll_5    = "WMINet_Utils.dll"
        $dll_6    = "cngprovider.dll"
        $dll_7    = "hpotiop1.dll"
        $dll_8    = "infoctrs.dll"

        $others_1 = "CreateIoCompletionPort"
        $others_2 = "NdrProxyForwardingFunction5"
        $others_3 = "NtAlpcDeleteSectionView"
        $others_4 = "GetAltTabInfo"
        $others_5 = "D:\\Builds\\Server\\64x\\Debug\\FS_Config\\Config.dat"
        $others_6 = "qeyuioaqeyuioaqe"
        $others_7 = "SetMagnificationLensCtxInformation"
        $others_8 = "TpDbgDumpHeapUsage"

    condition:
        uint16(0) == 0x5A4D and 
        (
            20 of them 
        )
}